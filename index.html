<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SN-√âl√©gance 221 ‚Äî Premium V2</title>
  <meta name="description" content="SN-√âl√©gance 221 ‚Äî Boutique premium de tissus Getzner. Achat au m√®tre, paiement Wave & Orange Money, commande via WhatsApp. Espace client et back-office vendeur (local)." />
  <meta name="theme-color" content="#0b0b0b">

  <!-- Styles (tout en une page pour facilit√© de d√©ploiement) -->
  <style>
    :root{
      --ivory:#F6F2EA;
      --gold-1:#C9A227;
      --gold-2:#E6BF52;
      --gold-grad: linear-gradient(90deg,var(--gold-1),var(--gold-2));
      --bg-dark:#0b0b0b;
      --card-dark:#0f0f10;
      --muted:#8b857d;
      --white:#f8f6f2;
      --shadow: 0 12px 36px rgba(0,0,0,0.36);
      font-family: Inter, "Segoe UI", Roboto, Arial, sans-serif;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--ivory),#f3efe8);color:var(--bg-dark);-webkit-font-smoothing:antialiased}
    a{color:inherit;text-decoration:none}
    /* ---------- Header ---------- */
    header{position:sticky;top:0;z-index:90;background:var(--card-dark);color:var(--white);border-bottom:1px solid rgba(255,255,255,0.03)}
    .header-inner{max-width:1200px;margin:0 auto;padding:12px 18px;display:flex;gap:12px;align-items:center}
    .logo{height:64px;width:auto}
    .brand{margin-left:6px;color:var(--white)}
    .site-title{font-size:18px;font-weight:800;color:var(--white)}
    .site-sub{font-size:12px;color:var(--muted)}
    .search-wrap{flex:1;display:flex;align-items:center;gap:8px;margin-left:12px}
    .search-input{flex:1;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:#111;color:#fff;font-size:15px}
    .search-btn{padding:10px 12px;border-radius:10px;border:none;background-image:var(--gold-grad);color:#07100a;font-weight:800;cursor:pointer}
    .top-actions{display:flex;gap:8px;align-items:center;margin-left:auto;font-size:13px;color:var(--white)}
    .category-menu{display:flex;gap:8px;align-items:center;padding:10px 18px;overflow:auto;background:#0b0b0b}
    /* ---------- Main ---------- */
    main{max-width:1200px;margin:18px auto;padding:0 16px 160px}
    .hero{display:flex;gap:18px;align-items:center;margin:10px 0 20px}
    .hero-left{flex:1}
    .hero h1{margin:0;font-size:26px;color:var(--white)}
    .hero p{color:var(--muted);margin:8px 0}
    .promo-bar{background:rgba(230,191,82,0.08);padding:10px;border-radius:10px;border:1px solid rgba(230,191,82,0.12);display:inline-block;color:var(--white)}
    /* ---------- Grid & Cards ---------- */
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px}
    .card{background:var(--card-dark);color:var(--white);border-radius:12px;padding:12px;border:1px solid rgba(255,255,255,0.04);box-shadow:var(--shadow);display:flex;flex-direction:column;min-height:480px}
    .thumbs{display:flex;gap:8px;justify-content:center;margin-bottom:12px;flex-wrap:wrap}
    .thumbs img{width:86px;height:86px;object-fit:cover;border-radius:10px;cursor:pointer;border:2px solid transparent;transition:transform .12s, box-shadow .12s}
    .thumbs img.active{border-color:var(--gold-1)}
    .main-photo{width:100%;height:260px;object-fit:cover;border-radius:10px;border:1px solid rgba(255,255,255,0.04);cursor:zoom-in}
    .title{font-weight:800;color:var(--gold-2);text-align:center;margin:8px 0 6px}
    .desc{color:var(--muted);font-size:14px;text-align:center;margin-bottom:8px}
    .price{font-weight:900;color:var(--gold-1);font-size:18px;text-align:center;margin-bottom:10px}
    .controls{display:flex;gap:8px;align-items:center;justify-content:center;margin-top:auto}
    input[type="number"]{width:90px;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);text-align:center;background:#111;color:#fff}
    .add-btn{background-image:var(--gold-grad);color:#07100a;padding:10px 14px;border-radius:10px;border:none;font-weight:800;cursor:pointer;transition:transform .12s}
    .add-btn:hover{transform:translateY(-3px)}
    .secondary-btn{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 10px;border-radius:8px;cursor:pointer;color:#fff}
    /* ---------- Floating cart ---------- */
    .cart-floating{
      position:fixed;right:18px;bottom:18px;width:64px;height:64px;border-radius:50%;background-image:var(--gold-grad);display:flex;align-items:center;justify-content:center;cursor:grab;box-shadow:0 18px 48px rgba(0,0,0,0.25);z-index:160;touch-action:none;
    }
    .cart-floating:active{cursor:grabbing}
    .cart-floating .count{position:absolute;top:-6px;right:-6px;background:#07100a;color:#fff;border-radius:50%;padding:4px 7px;font-size:12px;font-weight:800}
    .cart-panel{
      position:fixed;right:18px;bottom:92px;width:420px;max-height:78vh;background:var(--card-dark);border-radius:12px;padding:8px;border:1px solid rgba(255,255,255,0.04);box-shadow:0 40px 120px rgba(0,0,0,0.28);overflow:auto;z-index:150;
      opacity:0;visibility:hidden;transform:translateX(28px);transition:transform .28s cubic-bezier(.2,.9,.2,1),opacity .24s ease,visibility .24s;touch-action:none;
    }
    .cart-panel.open{opacity:1;visibility:visible;transform:translateX(0)}
    .cart-drag-handle{width:100%;height:36px;border-radius:8px;background:linear-gradient(90deg,rgba(255,255,255,0.02),transparent);display:flex;align-items:center;gap:8px;padding:6px 8px;margin-bottom:8px;cursor:grab}
    .cart-item{display:flex;gap:8px;align-items:center;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.02);margin-bottom:8px}
    .cart-item img{width:64px;height:64px;object-fit:cover;border-radius:8px}
    .cart-mini-meta{flex:1;color:var(--white)}
    .cart-total{display:flex;justify-content:space-between;align-items:center;font-weight:900;margin-top:8px;color:var(--gold-1)}
    .cart-actions{margin-top:10px;display:flex;gap:6px;flex-direction:column}
    .pay-row{display:flex;gap:8px}
    .pay-wave{flex:1;background:#0dbc5f;color:#07100a;padding:10px;border-radius:8px;border:none;font-weight:800;cursor:pointer}
    .pay-orange{flex:1;background:#ff7a00;color:#07100a;padding:10px;border-radius:8px;border:none;font-weight:800;cursor:pointer}
    .whatsapp-btn{background:#25D366;color:#07100a;padding:10px;border-radius:8px;border:none;font-weight:800;cursor:pointer}
    /* ---------- Modal & Auth UI ---------- */
    .modal-back{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;z-index:200}
    .modal{background:#fff;border-radius:12px;padding:16px;max-width:920px;width:94%;display:flex;gap:14px;box-shadow:0 30px 90px rgba(0,0,0,0.12)}
    .modal .left{flex:1}
    .modal .right{width:320px}
    .modal img{width:100%;border-radius:8px}
    .modal h3{margin:0;color:var(--gold-1)}
    .modal label{display:block;margin-top:8px;color:#555;font-size:13px}
    .small{font-size:13px;color:var(--muted)}
    .faq{margin-top:26px;background:var(--ivory);padding:16px;border-radius:12px;border:1px solid rgba(0,0,0,0.03)}
    footer{margin-top:30px;padding:18px;text-align:center;color:var(--muted)}
    .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:110px;background:rgba(10,10,10,0.9);color:#fff;padding:10px 14px;border-radius:10px;z-index:9999;display:flex;gap:8px;align-items:center;box-shadow:0 12px 36px rgba(0,0,0,0.4)}
    /* ---------- Seller dashboard ---------- */
    .seller-panel{position:fixed;left:18px;top:92px;width:360px;max-height:78vh;background:var(--card-dark);border-radius:12px;padding:12px;border:1px solid rgba(255,255,255,0.04);box-shadow:0 40px 120px rgba(0,0,0,0.28);overflow:auto;z-index:155;display:none}
    .seller-panel.open{display:block}
    .form-row{display:flex;gap:8px;flex-direction:column;margin-bottom:8px}
    .form-row input,.form-row textarea,.form-row select{padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06);width:100%}
    .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--white);padding:8px;border-radius:8px;cursor:pointer}
    /* responsive */
    @media(max-width:1000px){ .grid{grid-template-columns:repeat(2,1fr)} .cart-panel{right:12px;width:360px} .seller-panel{width:320px} }
    @media(max-width:700px){
      .grid{grid-template-columns:1fr}
      .header-inner{flex-direction:column;align-items:flex-start}
      .search-wrap{width:100%}
      .cart-panel{position:fixed;left:12px;right:12px;bottom:80px;width:auto}
      .main-photo{height:280px}
      .thumbs img{width:72px;height:72px}
      .cart-floating{width:56px;height:56px}
      .cart-panel{max-height:60vh}
      .seller-panel{left:12px;top:80px;width:calc(100% - 24px)}
    }
  </style>

  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9469166621216194"
     crossorigin="anonymous"></script>
</head>
<body>

  <!-- Cookie banner -->
  <div id="cookie-banner" style="position:fixed;bottom:0;width:100%;background:#111;color:#fff;padding:12px;text-align:center;z-index:1000;font-size:14px;">
    Ce site utilise des cookies pour am√©liorer votre exp√©rience.
    <button id="accept-cookies" style="margin-left:10px;padding:6px 10px;background:#222;color:white;border:none;cursor:pointer;border-radius:6px;">Accepter</button>
  </div>

  <!-- Header -->
  <header>
    <div class="header-inner">
      <img class="logo" src="https://i.postimg.cc/fWJvXsJ4/SN-Elegange.png" alt="SN-√âl√©gance logo">
      <div class="brand">
        <div class="site-title">SN-√âl√©gance 221</div>
        <div class="site-sub">Des tissus de prestige pour donner vie √† votre √©l√©gance unique.</div>
      </div>

      <div class="search-wrap">
        <input id="searchInput" class="search-input" type="search" placeholder="Rechercher un tissu (ex: Magnum, Brocade) ...">
        <button class="search-btn" onclick="applySearch()">Rechercher</button>
        <select id="sortSelect" class="select" onchange="applyFilters()">
          <option value="reco">Trier par : Recommand√©s</option>
          <option value="price-asc">Prix : bas ‚Üí haut</option>
          <option value="price-desc">Prix : haut ‚Üí bas</option>
          <option value="name-asc">Nom A‚ÜíZ</option>
        </select>
      </div>

      <div class="top-actions">
        <div style="text-align:right;font-size:13px;color:var(--white)">
          üìû +221 75 443 7491<br>üìû +221 78 432 4745
        </div>
        <div style="margin-left:12px">
          <button class="btn-ghost" id="openAuthBtn">Se connecter</button>
          <button class="btn-ghost" id="openSellerBtn">Vendeur</button>
        </div>
      </div>
    </div>

    <div class="category-menu" id="categoryMenu">
      <div class="category-chip" data-cat="all" onclick="filterByCategory('all')">Tous</div>
      <div class="category-chip" data-cat="magnum" onclick="filterByCategory('magnum')">Magnum</div>
      <div class="category-chip" data-cat="brocade" onclick="filterByCategory('brocade')">Brocade</div>
      <div class="category-chip" data-cat="wifi" onclick="filterByCategory('wifi')">Wifi</div>
      <div class="category-chip" data-cat="focus" onclick="filterByCategory('focus')">Focus</div>
    </div>
  </header>

  <!-- Main content -->
  <main>
    <section class="hero">
      <div class="hero-left">
        <h1>Collections Getzner ‚Äî Qualit√© & √©l√©gance</h1>
        <p>Choisissez votre tissu, s√©lectionnez la quantit√© en m√®tres et confirmez en quelques clics. Paiement Wave & Orange Money disponibles.</p>
        <div style="margin-top:10px"><span class="promo-bar">Promo : -10% √† partir de 5 m√®tres</span></div>
      </div>
    </section>

    <div id="productsGrid" class="grid" aria-live="polite"></div>

    <section style="margin-top:20px">
      <h3 style="color:var(--white)">Recommand√©s pour vous</h3>
      <div id="recommendGrid" style="display:flex;gap:12px;margin-top:12px;overflow:auto"></div>
    </section>

    <section class="faq">
      <h3>FAQ ‚Äî Livraison & Paiement</h3>
      <p><strong>Livraison locale :</strong> Nous livrons √† Dakar et environs via moto/transporteur. Le tarif d√©pend de la distance.</p>
      <p><strong>Livraison internationale :</strong> Sur demande ‚Äî contactez-nous par WhatsApp pour un devis.</p>
      <p><strong>Paiement :</strong> Wave (Promobile) et Orange Money accept√©s. Vous pouvez payer via QR ou manuellement, puis confirmer via WhatsApp.</p>
      <p><strong>Annulation / R√©clamation :</strong> Contactez-nous imm√©diatement sur WhatsApp avec la r√©f√©rence et le re√ßu.</p>
    </section>
  </main>

  <!-- Floating cart -->
  <div class="cart-floating" id="cartButton" title="Voir le panier" aria-label="Panier" role="button">
    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" aria-hidden>
      <path d="M3 3h2l.344 2M7 13h10l3-8H6.5" stroke="#07100a" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
      <circle cx="10" cy="20" r="1.6" fill="#07100a"/><circle cx="18" cy="20" r="1.6" fill="#07100a"/>
    </svg>
    <div class="count" id="cartCount">0</div>
  </div>

  <!-- Cart panel -->
  <div class="cart-panel" id="cartPanel" aria-live="polite">
    <div class="cart-drag-handle" id="cartHandle" tabindex="0" title="Glisser pour d√©placer le panier">
      <svg width="18" height="18" viewBox="0 0 24 24" style="margin-right:8px"><path d="M3 12h18" stroke="#777" stroke-width="1.6" stroke-linecap="round"/></svg>
      <strong style="flex:1;color:var(--white)">üõí Votre panier</strong>
      <button onclick="document.getElementById('cartPanel').classList.remove('open')" class="secondary-btn" title="Fermer">Fermer</button>
    </div>

    <div id="cartList" class="cart-list" style="padding:6px;color:var(--white)">Le panier est vide</div>

    <div class="cart-total">
      <div style="color:var(--white)">Total</div>
      <div id="cartTotal">0 CFA</div>
    </div>

    <div class="cart-actions">
      <button class="whatsapp-btn" onclick="openWhatsApp()">Commander via WhatsApp</button>
      <div class="pay-row">
        <button class="pay-wave" onclick="openPayModal('wave')">Payer Wave</button>
        <button class="pay-orange" onclick="openPayModal('orange')">Payer Orange</button>
      </div>
      <div class="small" style="margin-top:6px">Apr√®s paiement, cliquez sur "J'ai pay√©" dans la popup et confirmez via WhatsApp. </div>
    </div>
  </div>

  <!-- Seller panel -->
  <aside class="seller-panel" id="sellerPanel">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <strong style="color:var(--white)">üß∞ Tableau vendeur</strong>
      <button class="btn-ghost" id="closeSellerBtn">Fermer</button>
    </div>

    <div style="margin-bottom:8px;color:var(--muted);font-size:13px">Ajouter / modifier / supprimer des produits. Toutes les modifications sont stock√©es localement (localStorage).</div>

    <div style="margin-bottom:8px">
      <button class="add-btn" id="newProductBtn">Nouveau produit</button>
      <button class="btn-ghost" id="exportBtn">Exporter (JSON)</button>
      <button class="btn-ghost" id="importBtn">Importer (JSON)</button>
      <input id="importFile" type="file" accept="application/json" style="display:none">
    </div>

    <div id="sellerList"></div>
  </aside>

  <!-- Modals container -->
  <div id="modals"></div>

  <!-- Toast container -->
  <div id="toastContainer"></div>

  <footer>
    <div style="color:#fff">¬© 2025 SN-√âl√©gance 221</div>
    <div class="small" style="color:var(--muted)">T√©l√©phone : +221 75 443 7491 ‚Ä¢ +221 78 432 4745</div>
  </footer>

  <!-- ---------- JavaScript (logique compl√®te) ---------- -->
  <script>
  /****************************************************************
   * SN-√âl√©gance ‚Äî Premium V2
   * - Espace client (register/login)
   * - Seller dashboard (add/edit/delete products) ‚Äî localStorage
   * - Cart (draggable button + slide panel)
   * - Payments (Wave / Orange) via modal + QR code generator
   * - WhatsApp ordering
   * - Toasts & mobile vibration for feedback
   *
   * IMPORTANT:
   * - Pour la vente/prod : migrer l'auth & data vers un backend (Firebase/Supabase).
   * - Ce script fournit une solution "cl√© en main" c√¥t√© client pour prototype / vente.
   ****************************************************************/

  /* ==========================
     Default data & helpers
     ========================== */
  const DEFAULT_PRODUCTS_KEY = 'sn_products_v2';
  const CART_KEY = 'sn_cart_v2';
  const USERS_KEY = 'sn_users_v2';
  const ORDERS_KEY = 'sn_orders_v2';
  const SELLER_AUTH_KEY = 'sn_seller_auth'; // store seller login state
  const WHATSAPP_NUMBER = "221754437491";
  const WAVE_NUMBER = "+221754437491";
  const ORANGE_NUMBER = "+221784324745";

  // Default seller password (local prototype). Change in code if desired.
  // For production => move to server auth!
  const DEFAULT_SELLER_PASS = 'SNAdmin2025!';

  // Utility
  const el = (s) => document.querySelector(s);
  const elAll = (s) => Array.from(document.querySelectorAll(s));
  const money = n => Number(n).toLocaleString() + ' CFA';
  const readJSON = (k, fallback) => {
    try{ return JSON.parse(localStorage.getItem(k) || 'null') || fallback; } catch(e){ return fallback; }
  };
  const writeJSON = (k, v) => localStorage.setItem(k, JSON.stringify(v));

  // Load or init products
  let PRODUCTS = readJSON(DEFAULT_PRODUCTS_KEY, null);
  if(!PRODUCTS){
    PRODUCTS = [
      {
        id:'magnum',
        name:'Getzner Magnum Gold',
        price:11000,
        desc:'Le tissu Getzner Magnum Gold est reconnu pour sa qualit√© exceptionnelle et son √©clat raffin√©. Id√©al pour boubous et tenues de f√™te.',
        category:'magnum',
        images:[
          'https://i.postimg.cc/BQxHq1Wb/IMG-20250927-WA0060.jpg',
          'https://i.postimg.cc/VL15WGTv/IMG-20250927-WA0074.jpg',
          'https://i.postimg.cc/Wpm1zm3j/IMG-20250927-WA0066-1.jpg',
          'https://i.postimg.cc/ryg27fsp/IMG-20250927-WA0070.jpg',
          'https://i.postimg.cc/2yycsF9h/IMG-20250927-WA0064.jpg'
        ],
        rating:4.7, reviews:24
      },
      {
        id:'brocade',
        name:'Getzner Brocade',
        price:13000,
        desc:'Le Brocade est un tissu √©l√©gant aux motifs tiss√©s, parfait pour des tenues traditionnelles et c√©r√©monies.',
        category:'brocade',
        images:[
          'https://i.postimg.cc/5yz79NJk/IMG-20250927-WA0084.jpg',
          'https://i.postimg.cc/L89TwVq2/IMG-20250927-WA0086-1.jpg',
          'https://i.postimg.cc/R0r0qgcC/IMG-20250927-WA0085.jpg',
          'https://i.postimg.cc/wvqgsZ36/IMG-20250927-WA0103.jpg',
          'https://i.postimg.cc/mDDK4sth/IMG-20250927-WA0102-1.jpg'
        ],
        rating:4.9, reviews:31
      },
      {
        id:'wifi',
        name:'Getzner Wifi',
        price:13000,
        desc:'Le tissu Wifi s√©duit par ses motifs originaux et sa souplesse, id√©al pour un usage quotidien ou √©v√©nementiel.',
        category:'wifi',
        images:[
          'https://i.postimg.cc/15rxDJhX/IMG-20250927-WA0094.jpg',
          'https://i.postimg.cc/WbnKdzgd/IMG-20250927-WA0096-1.jpg',
          'https://i.postimg.cc/02Wngw7Z/IMG-20250917-WA0031.jpg',
          'https://i.postimg.cc/7LgSLGJ7/IMG-20250927-WA0098.jpg',
          'https://i.postimg.cc/MZrfqb3h/IMG-20250917-WA0028.jpg'
        ],
        rating:4.6, reviews:18
      },
      {
        id:'focus',
        name:'Getzner Focus',
        price:14000,
        desc:'Le Focus se distingue par sa texture soyeuse et son tomb√© fluide, parfait pour des tenues modernes et √©l√©gantes.',
        category:'focus',
        images:[
          'https://i.postimg.cc/v8jTp8c6/IMG-20250927-WA0050.jpg',
          'https://i.postimg.cc/bw0vDQLG/IMG-20250927-WA0054.jpg',
          'https://i.postimg.cc/Dfts1PQB/IMG-20250927-WA0041.jpg',
          'https://i.postimg.cc/Wbw3tG5t/IMG-20250927-WA0044.jpg',
          'https://i.postimg.cc/tJtXZbNR/IMG-20250927-WA0031.jpg'
        ],
        rating:4.8, reviews:21
      },
    ];
    writeJSON(DEFAULT_PRODUCTS_KEY, PRODUCTS);
  }

  // Cart & users
  let CART = readJSON(CART_KEY, []);
  let USERS = readJSON(USERS_KEY, []); // {id,email,phone,password,name}
  let ORDERS = readJSON(ORDERS_KEY, []); // order objects

  /* ==========================
     Render products (grid)
     ========================== */
  function renderProducts(list = PRODUCTS) {
    const grid = el('#productsGrid');
    grid.innerHTML = '';
    list.forEach(p => {
      const card = document.createElement('article');
      card.className = 'card product';
      card.dataset.id = p.id;
      card.innerHTML = `
        <img class="main-photo" src="${p.images[0]}" alt="${p.name}">
        <div class="thumbs">${p.images.map((s,i)=>`<img data-src="${s}" ${i===0?'class="active"':''} src="${s}" alt="${p.name}">`).join('')}</div>
        <div class="title">${p.name}</div>
        <div class="desc">${p.desc}</div>
        <div style="display:flex;justify-content:center;gap:10px;align-items:center">
          <div class="price">${p.price.toLocaleString()} CFA / m</div>
          <div style="margin-left:6px;color:var(--muted);font-size:13px">‚≠ê ${p.rating} (${p.reviews})</div>
        </div>
        <div class="controls">
          <input type="number" min="1" value="1" class="quick-qty" aria-label="Quantit√© (m√®tres)">
          <button class="add-btn" onclick="addFromCard(this)">Ajouter</button>
          <button class="secondary-btn" onclick="openBuyModalFromCard(this)">Voir</button>
        </div>
      `;
      grid.appendChild(card);

      // events
      const thumbs = card.querySelectorAll('.thumbs img');
      thumbs.forEach(img => {
        img.addEventListener('click', () => {
          thumbs.forEach(t=>t.classList.remove('active'));
          img.classList.add('active');
          card.querySelector('.main-photo').src = img.dataset.src || img.src;
          openBuyModal(img);
        });
        img.addEventListener('dblclick', ()=> openImageLightbox(img.dataset.src || img.src));
      });

      card.querySelector('.main-photo').addEventListener('click', (e)=> openBuyModal(e.currentTarget));
    });
  }
  renderProducts();

  /* Recommendations */
  function renderRecommendations(){
    const rec = el('#recommendGrid');
    rec.innerHTML = '';
    PRODUCTS.slice(0,4).forEach(p=>{
      const box = document.createElement('div');
      box.style.minWidth='180px';
      box.style.background='linear-gradient(180deg,#0f0f10,#0b0b0b)';
      box.style.borderRadius='10px';
      box.style.padding='8px';
      box.style.border='1px solid rgba(255,255,255,0.04)';
      box.style.boxShadow='var(--shadow)';
      box.innerHTML = `<img src="${p.images[0]}" style="width:160px;height:100px;object-fit:cover;border-radius:8px"><div style="font-weight:800;margin-top:6px;color:var(--gold-2)">${p.name}</div><div style="color:var(--muted);font-size:13px">${p.price.toLocaleString()} CFA / m</div>`;
      box.addEventListener('click', ()=> {
        const target = document.querySelector(`.product[data-id="${p.id}"]`);
        target?.scrollIntoView({behavior:'smooth', block:'center'});
        target?.querySelector('.main-photo')?.click();
      });
      rec.appendChild(box);
    });
  }
  renderRecommendations();

  /* ==========================
     Search & filters
     ========================== */
  let CURRENT_LIST = PRODUCTS.slice();
  function applySearch(){
    const q = el('#searchInput').value.trim().toLowerCase();
    CURRENT_LIST = PRODUCTS.slice();
    if(q) CURRENT_LIST = CURRENT_LIST.filter(p => (p.name + ' ' + p.desc).toLowerCase().includes(q));
    applySort();
    renderProducts(CURRENT_LIST);
  }
  function filterByCategory(cat){
    if(cat === 'all') CURRENT_LIST = PRODUCTS.slice();
    else CURRENT_LIST = PRODUCTS.filter(p => p.category === cat);
    elAll('.category-chip').forEach(ch => ch.style.background = ch.dataset.cat === cat ? 'rgba(230,191,82,0.12)' : 'transparent');
    applySort();
    renderProducts(CURRENT_LIST);
  }
  function applySort(){
    const s = el('#sortSelect').value;
    if(s === 'price-asc') CURRENT_LIST.sort((a,b)=>a.price-b.price);
    else if(s === 'price-desc') CURRENT_LIST.sort((a,b)=>b.price-a.price);
    else if(s === 'name-asc') CURRENT_LIST.sort((a,b)=>a.name.localeCompare(b.name));
    else CURRENT_LIST.sort((a,b)=>b.rating-a.rating);
    renderProducts(CURRENT_LIST);
  }

  /* ==========================
     Lightbox & product modal
     ========================== */
  function openImageLightbox(src){
    const back = document.createElement('div'); back.className='modal-back';
    back.innerHTML = `<div class="modal" style="max-width:900px;flex-direction:column"><img src="${src}" style="max-width:100%;border-radius:8px"><div style="margin-top:8px;text-align:right"><button class="secondary-btn" onclick="this.closest('.modal-back').remove()">Fermer</button></div></div>`;
    document.getElementById('modals').appendChild(back);
    back.addEventListener('click',(e)=>{ if(e.target===back) back.remove(); });
  }

  function openBuyModal(imgOrEl){
    const imgEl = imgOrEl;
    const card = imgEl.closest('.product');
    const id = card.dataset.id;
    const product = PRODUCTS.find(p=>p.id === id);
    if(!product) return;
    const mainSrc = imgEl.dataset?.src || imgEl.src;
    const back = document.createElement('div'); back.className='modal-back';
    back.innerHTML = `
      <div class="modal" role="dialog" aria-modal="true">
        <div class="left">
          <img src="${mainSrc}" alt="${product.name}">
          <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap">
            ${product.images.map(s=>`<img src="${s}" style="width:80px;height:60px;object-fit:cover;border-radius:6px;cursor:pointer" onclick="document.querySelector('.modal img').src='${s}'">`).join('')}
          </div>
        </div>
        <div class="right">
          <h3>${product.name}</h3>
          <div class="small">${product.desc}</div>
          <div style="margin-top:8px" class="small">Prix : <strong>${money(product.price)}</strong> / m√®tre</div>
          <label>Quantit√© (m√®tres)</label>
          <input type="number" id="modalQty" min="1" value="1">
          <label>Nom (optionel)</label><input type="text" id="modalName" placeholder="Votre nom">
          <label>T√©l√©phone (optionel)</label><input type="text" id="modalPhone" placeholder="+221 ...">
          <label>Remarque (optionel)</label><input type="text" id="modalNotes" placeholder="Ex: livraison urgente">
          <div style="margin-top:10px" class="small">Total : <strong id="modalTotal">${money(product.price)}</strong></div>
          <div style="margin-top:12px;display:flex;gap:8px">
            <button class="add-btn" id="modalAdd">Ajouter au panier</button>
            <button class="secondary-btn" id="modalClose">Fermer</button>
          </div>
        </div>
      </div>`;
    document.getElementById('modals').appendChild(back);

    const qtyInput = back.querySelector('#modalQty');
    const totalEl = back.querySelector('#modalTotal');
    const nameInput = back.querySelector('#modalName');
    const phoneInput = back.querySelector('#modalPhone');
    const notesInput = back.querySelector('#modalNotes');

    const updateTotal = ()=> {
      const q = Math.max(1, parseInt(qtyInput.value||1,10));
      const base = product.price * q;
      const discount = q >= 5 ? Math.round(base * 0.10) : 0;
      totalEl.textContent = money(base - discount);
    };
    qtyInput.addEventListener('input', updateTotal);

    back.querySelector('#modalClose').addEventListener('click', ()=> back.remove());
    back.querySelector('#modalAdd').addEventListener('click', ()=>{
      const q = Math.max(1, parseInt(qtyInput.value||1,10));
      const nameVal = nameInput.value.trim();
      const phoneVal = phoneInput.value.trim();
      const notesVal = notesInput.value.trim();
      addToCart({
        id: product.id,
        name: product.name,
        price: product.price,
        qty: q,
        img: mainSrc,
        notes: notesVal,
        buyerName: nameVal,
        buyerPhone: phoneVal
      });
      back.remove();
    });

    back.addEventListener('click', (e)=>{ if(e.target === back) back.remove(); });
  }

  function openBuyModalFromCard(btn){
    const card = btn.closest('.product');
    card.querySelector('.main-photo').click();
  }

  /* ==========================
     Cart logic
     ========================== */
  function saveCart(){ writeJSON(CART_KEY, CART); }
  function addToCart(item){
    const existing = CART.find(i=>i.id === item.id && i.img === item.img);
    if(existing){
      existing.qty += item.qty;
      if(item.notes) existing.notes = item.notes;
      if(item.buyerName) existing.buyerName = item.buyerName;
      if(item.buyerPhone) existing.buyerPhone = item.buyerPhone;
    } else {
      CART.push(item);
    }
    saveCart(); renderCart(); flashCartButton(); openCart();
    showToast('‚úÖ Ajout√© au panier');
    if(navigator.vibrate) navigator.vibrate(100);
  }

  function renderCart(){
    const list = el('#cartList');
    const totalEl = el('#cartTotal');
    list.innerHTML = '';
    if(CART.length === 0){
      list.textContent = 'Le panier est vide';
      el('#cartCount').textContent = '0';
      totalEl.textContent = '0 CFA';
      return;
    }
    let grandTotal = 0;
    CART.forEach((it, idx)=>{
      const lineBase = it.price * it.qty;
      const lineDiscount = it.qty >= 5 ? Math.round(lineBase * 0.10) : 0;
      const lineTotal = lineBase - lineDiscount;
      grandTotal += lineTotal;
      const row = document.createElement('div');
      row.className = 'cart-item';
      row.innerHTML = `
        <img src="${it.img}" alt="${it.name}">
        <div class="cart-mini-meta">
          <div style="font-weight:800">${it.name}</div>
          <div class="small">${it.qty} m ‚Ä¢ ${money(it.price)} / m</div>
          ${it.notes ? `<div class="small">Remarque: ${escapeHtml(it.notes)}</div>` : ''}
          ${it.qty >=5 ? `<div style="color:green;font-weight:800" class="small">Remise 10% appliqu√©e</div>` : ''}
        </div>
        <div style="text-align:right">
          <div style="font-weight:900">${money(lineTotal)}</div>
          <div style="display:flex;gap:6px;margin-top:6px;justify-content:flex-end">
            <button class="secondary-btn" onclick="changeQty(${idx},1)">+</button>
            <button class="secondary-btn" onclick="changeQty(${idx},-1)">‚àí</button>
            <button class="secondary-btn" onclick="removeItem(${idx})">Suppr</button>
          </div>
        </div>
      `;
      list.appendChild(row);
    });
    totalEl.textContent = grandTotal.toLocaleString() + ' CFA';
    el('#cartCount').textContent = CART.reduce((s,i)=>s+i.qty,0);
  }

  function changeQty(idx, delta){
    if(!CART[idx]) return;
    CART[idx].qty = Math.max(0, CART[idx].qty + delta);
    if(CART[idx].qty === 0) CART.splice(idx,1);
    saveCart(); renderCart();
  }
  function removeItem(idx){ CART.splice(idx,1); saveCart(); renderCart(); }

  function toggleCart(){ const panel = el('#cartPanel'); panel.classList.toggle('open'); }
  function openCart(){ el('#cartPanel').classList.add('open'); }

  function addFromCard(btn){
    const card = btn.closest('.product');
    const id = card.dataset.id;
    const product = PRODUCTS.find(p=>p.id===id);
    const qty = Math.max(1, parseInt(card.querySelector('.quick-qty').value||1,10));
    const img = card.querySelector('.thumbs img').dataset.src || card.querySelector('.thumbs img').src;
    addToCart({id:product.id,name:product.name,price:product.price,qty,img});
  }

  function flashCartButton(){ el('#cartButton').animate([{transform:'scale(1)'},{transform:'scale(1.08)'},{transform:'scale(1)'}],{duration:300}); }
  function escapeHtml(str){ return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
  function showToast(text, ms=1500){
    const id = 'toast-' + Date.now();
    const t = document.createElement('div');
    t.className = 'toast';
    t.id = id;
    t.innerHTML = `<div>${text}</div>`;
    document.getElementById('toastContainer').appendChild(t);
    setTimeout(()=>{ t.style.transition='opacity 300ms'; t.style.opacity=0; setTimeout(()=>t.remove(),320); }, ms);
  }

  /* ==========================
     WhatsApp & Payments
     ========================== */
  function openWhatsApp(){
    if(CART.length === 0){ alert('Le panier est vide.'); return; }
    let total = 0;
    let msg = 'Bonjour,%0AJ‚Äôaimerais commander :%0A';
    CART.forEach(it => {
      const base = it.price * it.qty;
      const disc = it.qty >=5 ? Math.round(base * 0.10) : 0;
      const ln = base - disc;
      msg += `- ${it.qty} m de ${it.name} -> ${ln.toLocaleString()} CFA%0A`;
      if(it.notes) msg += `  Remarque: ${encodeURIComponent(it.notes)}%0A`;
      total += ln;
    });
    msg += `Total : ${total.toLocaleString()} CFA%0A%0ANom : %0AT√©l√©phone :%0AAdresse :`;
    const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(decodeURIComponent(msg))}`;
    window.open(url,'_blank');
  }

  function openPayModal(method){
    if(CART.length === 0){ alert('Le panier est vide.'); return; }
    const total = CART.reduce((s,it)=> {
      const base = it.price * it.qty;
      const disc = it.qty >=5 ? Math.round(base * 0.10) : 0;
      return s + (base - disc);
    }, 0);
    const number = method === 'wave' ? WAVE_NUMBER : ORANGE_NUMBER;
    const label = method === 'wave' ? 'Wave (Promobile)' : 'Orange Money';
    const qrText = `${label} ${number} Montant:${total}CFA`;
    const qrUrl = `https://chart.googleapis.com/chart?chs=260x260&cht=qr&chl=${encodeURIComponent(qrText)}`;

    const back = document.createElement('div'); back.className='modal-back';
    back.innerHTML = `
      <div class="modal" role="dialog" aria-modal="true">
        <div style="flex:1">
          <h3>${label}</h3>
          <div class="small">Num√©ro : <strong>${number}</strong></div>
          <div class="small">Montant : <strong>${total.toLocaleString()} CFA</strong></div>
          <div style="margin-top:10px" class="small">Scannez le QR pour effectuer le paiement ou payez manuellement puis cliquez sur "J'ai pay√©" pour confirmer.</div>
          <div style="margin-top:12px"><img src="${qrUrl}" alt="QR Code" style="max-width:220px;border:6px solid #fff;border-radius:10px"></div>
          <label>R√©f√©rence paiement (ex: transaction ID)</label>
          <input type="text" id="payRef" placeholder="Ex: REF12345" style="width:100%;padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06);margin-top:6px">
        </div>
        <div style="width:220px;display:flex;flex-direction:column;gap:8px;align-items:center">
          <button class="add-btn" id="paidConfirm">J'ai pay√© ‚Äî Confirmer</button>
          <button class="secondary-btn" id="payClose">Fermer</button>
        </div>
      </div>
    `;
    document.getElementById('modals').appendChild(back);
    back.querySelector('#payClose').addEventListener('click', ()=> back.remove());
    back.querySelector('#paidConfirm').addEventListener('click', ()=>{
      const ref = back.querySelector('#payRef').value.trim();
      let msg = `Bonjour, j'ai effectu√© un paiement de ${total.toLocaleString()} CFA via ${label} (${number}).%0AR√©f√©rence: ${encodeURIComponent(ref)}%0ACommande:%0A`;
      CART.forEach(it => {
        const base = it.price * it.qty;
        const disc = it.qty >=5 ? Math.round(base * 0.10) : 0;
        const ln = base - disc;
        msg += `- ${it.qty} m de ${it.name} -> ${ln.toLocaleString()} CFA%0A`;
      });
      msg += `Total : ${total.toLocaleString()} CFA%0A%0ANom :%0AT√©l√©phone :%0AAdresse :`;
      const wa = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(decodeURIComponent(msg))}`;
      window.open(wa, '_blank');
      back.remove();
    });
  }

  /* ==========================
     Draggable behavior (btn + panel)
     ========================== */
  (function makeDraggable(){
    const btn = el('#cartButton');
    const panel = el('#cartPanel');
    const handle = el('#cartHandle');

    // restore saved positions
    const savedBtn = JSON.parse(localStorage.getItem('cartBtnPos')||'null');
    if(savedBtn){
      btn.style.left = savedBtn.x + 'px';
      btn.style.top = savedBtn.y + 'px';
      btn.style.right = 'auto';
      btn.style.bottom = 'auto';
      btn.style.position = 'fixed';
    }
    const savedPanel = JSON.parse(localStorage.getItem('cartPanelPos')||'null');
    if(savedPanel){
      panel.style.left = savedPanel.x + 'px';
      panel.style.top = savedPanel.y + 'px';
      panel.style.right = 'auto';
      panel.style.bottom = 'auto';
      panel.style.position = 'fixed';
    }

    function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }

    // button drag
    btn.addEventListener('pointerdown', startBtn);
    function startBtn(e){
      e.preventDefault();
      btn.setPointerCapture(e.pointerId);
      const rect = btn.getBoundingClientRect();
      const startX = e.clientX;
      const startY = e.clientY;
      const offsetX = startX - rect.left;
      const offsetY = startY - rect.top;
      function onMove(ev){
        ev.preventDefault();
        let x = ev.clientX - offsetX;
        let y = ev.clientY - offsetY;
        const vw = Math.max(document.documentElement.clientWidth, window.innerWidth||0);
        const vh = Math.max(document.documentElement.clientHeight, window.innerHeight||0);
        x = clamp(x,6, vw - rect.width - 6);
        y = clamp(y,6, vh - rect.height - 6);
        btn.style.left = x + 'px';
        btn.style.top = y + 'px';
        btn.style.right = 'auto';
        btn.style.bottom = 'auto';
        btn.style.position = 'fixed';
      }
      function end(ev){
        btn.releasePointerCapture(e.pointerId);
        document.removeEventListener('pointermove', onMove);
        document.removeEventListener('pointerup', end);
        const left = parseInt(btn.style.left || btn.getBoundingClientRect().left, 10);
        const top = parseInt(btn.style.top || btn.getBoundingClientRect().top, 10);
        localStorage.setItem('cartBtnPos', JSON.stringify({x:left, y:top}));
      }
      document.addEventListener('pointermove', onMove);
      document.addEventListener('pointerup', end);
    }

    // tap vs drag
    let btnDown = null;
    btn.addEventListener('pointerdown', (e)=> btnDown = {x:e.clientX, y:e.clientY, t:Date.now()});
    btn.addEventListener('pointerup', (e)=>{
      if(!btnDown) return;
      const dx = Math.abs(e.clientX - btnDown.x);
      const dy = Math.abs(e.clientY - btnDown.y);
      const dt = Date.now() - btnDown.t;
      btnDown = null;
      if(dx < 6 && dy < 6 && dt < 300) toggleCart();
    });

    // panel drag via handle
    handle.addEventListener('pointerdown', startPanel);
    function startPanel(e){
      e.preventDefault();
      handle.setPointerCapture(e.pointerId);
      const rect = panel.getBoundingClientRect();
      const startX = e.clientX;
      const startY = e.clientY;
      const offsetX = startX - rect.left;
      const offsetY = startY - rect.top;
      function onMove(ev){
        ev.preventDefault();
        let x = ev.clientX - offsetX;
        let y = ev.clientY - offsetY;
        const vw = Math.max(document.documentElement.clientWidth, window.innerWidth||0);
        const vh = Math.max(document.documentElement.clientHeight, window.innerHeight||0);
        x = clamp(x,6, vw - rect.width - 6);
        y = clamp(y,6, vh - rect.height - 6);
        panel.style.left = x + 'px';
        panel.style.top = y + 'px';
        panel.style.right = 'auto';
        panel.style.bottom = 'auto';
        panel.style.position = 'fixed';
      }
      function end(ev){
        handle.releasePointerCapture(e.pointerId);
        document.removeEventListener('pointermove', onMove);
        document.removeEventListener('pointerup', end);
        const left = parseInt(panel.style.left || panel.getBoundingClientRect().left, 10);
        const top = parseInt(panel.style.top || panel.getBoundingClientRect().top, 10);
        localStorage.setItem('cartPanelPos', JSON.stringify({x:left, y:top}));
      }
      document.addEventListener('pointermove', onMove);
      document.addEventListener('pointerup', end);
    }

    // reset panel position on dblclick
    handle.addEventListener('dblclick', ()=>{
      localStorage.removeItem('cartPanelPos');
      panel.style.left = 'auto';
      panel.style.top = 'auto';
      panel.style.right = '18px';
      panel.style.bottom = '92px';
      panel.style.position = 'fixed';
    });
  })();

  /* ==========================
     Auth / Users (client-side)
     ========================== */
  // Simple register/login modals
  function openAuthModal(){
    const back = document.createElement('div'); back.className = 'modal-back';
    back.innerHTML = `
      <div class="modal" role="dialog" aria-modal="true" style="max-width:720px">
        <div style="flex:1;padding-right:6px">
          <h3>Connexion / Inscription</h3>
          <p class="small">Cr√©ez un compte client pour retrouver vos commandes (localement).</p>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button class="add-btn" id="switchLogin">Se connecter</button>
            <button class="secondary-btn" id="switchRegister">S'inscrire</button>
          </div>
          <div id="authForm" style="margin-top:12px"></div>
        </div>
        <div style="width:260px;display:flex;flex-direction:column;gap:8px;align-items:center">
          <div style="width:100%;height:180px;background:linear-gradient(180deg,var(--gold-1),var(--gold-2));border-radius:12px;display:flex;align-items:center;justify-content:center;color:#07100a;font-weight:800">SN-√âl√©gance</div>
          <button class="secondary-btn" id="closeAuth">Fermer</button>
        </div>
      </div>`;
    document.getElementById('modals').appendChild(back);
    const authForm = back.querySelector('#authForm');
    const closeBtn = back.querySelector('#closeAuth');
    closeBtn.addEventListener('click', ()=> back.remove());
    back.querySelector('#switchLogin').addEventListener('click', ()=> renderLogin());
    back.querySelector('#switchRegister').addEventListener('click', ()=> renderRegister());
    function renderLogin(){
      authForm.innerHTML = `
        <label>Email ou t√©l√©phone</label><input id="ln" placeholder="email@example.com ou +221..." />
        <label>Mot de passe</label><input id="lp" type="password" placeholder="mot de passe" />
        <div style="margin-top:8px"><button class="add-btn" id="doLogin">Connexion</button></div>
      `;
      authForm.querySelector('#doLogin').addEventListener('click', ()=>{
        const ln = authForm.querySelector('#ln').value.trim();
        const lp = authForm.querySelector('#lp').value.trim();
        if(!ln || !lp){ alert('Remplissez tous les champs'); return; }
        const user = USERS.find(u => u.email===ln || u.phone===ln);
        if(!user || user.password !== lp){ alert('Utilisateur introuvable ou mot de passe incorrect'); return; }
        // store logged user id
        localStorage.setItem('sn_logged_user', user.id);
        showToast('‚úÖ Connect√©');
        back.remove();
      });
    }
    function renderRegister(){
      authForm.innerHTML = `
        <label>Nom</label><input id="rn" placeholder="Votre nom" />
        <label>Email</label><input id="re" placeholder="email@example.com" />
        <label>T√©l√©phone</label><input id="rp" placeholder="+221..." />
        <label>Mot de passe</label><input id="rpass" type="password" placeholder="mot de passe" />
        <div style="margin-top:8px"><button class="add-btn" id="doRegister">S'inscrire</button></div>
      `;
      authForm.querySelector('#doRegister').addEventListener('click', ()=>{
        const name = authForm.querySelector('#rn').value.trim();
        const email = authForm.querySelector('#re').value.trim();
        const phone = authForm.querySelector('#rp').value.trim();
        const pwd = authForm.querySelector('#rpass').value.trim();
        if(!name || !email || !phone || !pwd){ alert('Remplissez tous les champs'); return; }
        if(USERS.find(u=>u.email===email || u.phone===phone)){ alert('Utilisateur d√©j√† existant'); return; }
        const id = 'u_' + Date.now();
        const user = {id, name, email, phone, password: pwd};
        USERS.push(user); writeJSON(USERS_KEY, USERS);
        localStorage.setItem('sn_logged_user', id);
        showToast('‚úÖ Compte cr√©√©');
        back.remove();
      });
    }
    renderLogin();
    back.addEventListener('click', (e)=>{ if(e.target === back) back.remove(); });
  }

  // helper to get current user
  function getCurrentUser(){
    const id = localStorage.getItem('sn_logged_user');
    if(!id) return null;
    return USERS.find(u=>u.id === id) || null;
  }

  /* ==========================
     Seller dashboard / admin (local)
     ==========================
     - Accessible via "Vendeur" button.
     - Password: DEFAULT_SELLER_PASS (change locally if you wish).
     - Provides: add / edit / delete products. Changes persisted to localStorage.
  */
  function openSellerPanel(){
    // prompt for seller password if not logged
    const authed = localStorage.getItem(SELLER_AUTH_KEY) === 'true';
    if(!authed){
      const pass = prompt('Acc√®s vendeur ‚Äî mot de passe :');
      if(pass !== DEFAULT_SELLER_PASS){ alert('Mot de passe incorrect'); return; }
      localStorage.setItem(SELLER_AUTH_KEY, 'true');
    }
    renderSellerPanel();
    el('#sellerPanel').classList.add('open');
  }

  function closeSellerPanel(){
    el('#sellerPanel').classList.remove('open');
  }

  function renderSellerPanel(){
    const list = el('#sellerList');
    list.innerHTML = '';
    PRODUCTS.forEach((p, idx) => {
      const row = document.createElement('div');
      row.style.border = '1px solid rgba(255,255,255,0.03)';
      row.style.padding = '8px';
      row.style.borderRadius = '8px';
      row.style.marginBottom = '8px';
      row.innerHTML = `
        <div style="display:flex;gap:8px;align-items:center">
          <img src="${p.images[0]}" style="width:64px;height:64px;object-fit:cover;border-radius:6px">
          <div style="flex:1">
            <div style="font-weight:800">${p.name}</div>
            <div class="small">${p.price.toLocaleString()} CFA / m</div>
            <div class="small" style="color:var(--muted)">${p.category}</div>
          </div>
          <div style="display:flex;flex-direction:column;gap:6px">
            <button class="btn-ghost" data-idx="${idx}" onclick="editProduct(${idx})">Modifier</button>
            <button class="btn-ghost" data-idx="${idx}" onclick="deleteProduct(${idx})">Suppr</button>
          </div>
        </div>
      `;
      list.appendChild(row);
    });
  }

  function deleteProduct(idx){
    if(!confirm('Supprimer ce produit ?')) return;
    PRODUCTS.splice(idx,1);
    writeJSON(DEFAULT_PRODUCTS_KEY, PRODUCTS);
    renderProducts(PRODUCTS);
    renderRecommendations();
    renderSellerPanel();
    showToast('‚úÖ Produit supprim√©');
  }

  function editProduct(idx){
    const p = PRODUCTS[idx];
    const back = document.createElement('div'); back.className='modal-back';
    back.innerHTML = `<div class="modal" role="dialog" aria-modal="true">
      <div style="flex:1">
        <h3>Modifier produit</h3>
        <div class="form-row"><label>Nom</label><input id="ep_name" value="${escapeHtml(p.name)}"></div>
        <div class="form-row"><label>Prix (CFA)</label><input id="ep_price" value="${p.price}"></div>
        <div class="form-row"><label>Cat√©gorie</label><input id="ep_cat" value="${p.category}"></div>
        <div class="form-row"><label>Description</label><textarea id="ep_desc">${escapeHtml(p.desc)}</textarea></div>
        <div class="form-row"><label>Images (URLs, s√©par√©es par des virgules)</label><textarea id="ep_imgs">${p.images.join(',')}</textarea></div>
        <div style="margin-top:8px;display:flex;gap:8px"><button class="add-btn" id="saveEdit">Enregistrer</button><button class="secondary-btn" id="cancelEdit">Annuler</button></div>
      </div>
    </div>`;
    document.getElementById('modals').appendChild(back);
    back.querySelector('#cancelEdit').addEventListener('click', ()=> back.remove());
    back.querySelector('#saveEdit').addEventListener('click', ()=>{
      const name = back.querySelector('#ep_name').value.trim();
      const price = Number(back.querySelector('#ep_price').value || 0);
      const cat = back.querySelector('#ep_cat').value.trim();
      const desc = back.querySelector('#ep_desc').value.trim();
      const imgs = back.querySelector('#ep_imgs').value.split(',').map(s=>s.trim()).filter(Boolean);
      if(!name || !price || imgs.length===0){ alert('Nom, prix et au moins 1 image requis'); return; }
      PRODUCTS[idx] = {...PRODUCTS[idx], name, price, category:cat, desc, images: imgs};
      writeJSON(DEFAULT_PRODUCTS_KEY, PRODUCTS);
      renderProducts(PRODUCTS);
      renderRecommendations();
      renderSellerPanel();
      back.remove();
      showToast('‚úÖ Produit modifi√©');
    });
    back.addEventListener('click', (e)=>{ if(e.target === back) back.remove(); });
  }

  // create new product form
  function newProductFlow(){
    const back = document.createElement('div'); back.className='modal-back';
    back.innerHTML = `<div class="modal" role="dialog" aria-modal="true">
      <div style="flex:1">
        <h3>Nouveau produit</h3>
        <div class="form-row"><label>ID (r√©f√©rence interne)</label><input id="np_id" placeholder="ex: magnum2"></div>
        <div class="form-row"><label>Nom</label><input id="np_name" placeholder="Nom du tissu"></div>
        <div class="form-row"><label>Prix (CFA)</label><input id="np_price" placeholder="11000"></div>
        <div class="form-row"><label>Cat√©gorie</label><input id="np_cat" placeholder="magnum"></div>
        <div class="form-row"><label>Description</label><textarea id="np_desc" placeholder="Description"></textarea></div>
        <div class="form-row"><label>Images (URLs, s√©par√©es par des virgules)</label><textarea id="np_imgs" placeholder="https://... , https://..."></textarea></div>
        <div style="margin-top:8px;display:flex;gap:8px"><button class="add-btn" id="createProd">Cr√©er</button><button class="secondary-btn" id="cancelCreate">Annuler</button></div>
      </div>
    </div>`;
    document.getElementById('modals').appendChild(back);
    back.querySelector('#cancelCreate').addEventListener('click', ()=> back.remove());
    back.querySelector('#createProd').addEventListener('click', ()=>{
      const id = back.querySelector('#np_id').value.trim() || ('p_' + Date.now());
      const name = back.querySelector('#np_name').value.trim();
      const price = Number(back.querySelector('#np_price').value || 0);
      const cat = back.querySelector('#np_cat').value.trim();
      const desc = back.querySelector('#np_desc').value.trim();
      const imgs = back.querySelector('#np_imgs').value.split(',').map(s=>s.trim()).filter(Boolean);
      if(!name || !price || imgs.length===0){ alert('Nom, prix et au moins 1 image requis'); return; }
      const newP = { id, name, price, category:cat || 'autre', desc, images: imgs, rating:4.5, reviews:0 };
      PRODUCTS.push(newP);
      writeJSON(DEFAULT_PRODUCTS_KEY, PRODUCTS);
      renderProducts(PRODUCTS);
      renderRecommendations();
      renderSellerPanel();
      back.remove();
      showToast('‚úÖ Produit ajout√©');
    });
    back.addEventListener('click', (e)=>{ if(e.target === back) back.remove(); });
  }

  /* Export / Import products JSON */
  function exportProducts(){
    const data = JSON.stringify(PRODUCTS, null, 2);
    const blob = new Blob([data], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'sn_products_export.json'; a.click();
    URL.revokeObjectURL(url);
  }
  function importProductsFile(file){
    const reader = new FileReader();
    reader.onload = (e) => {
      try{
        const arr = JSON.parse(e.target.result);
        if(!Array.isArray(arr)){ alert('Fichier invalide'); return; }
        PRODUCTS = arr;
        writeJSON(DEFAULT_PRODUCTS_KEY, PRODUCTS);
        renderProducts(PRODUCTS);
        renderRecommendations();
        renderSellerPanel();
        showToast('‚úÖ Import termin√©');
      }catch(err){ alert('Erreur import : ' + err.message); }
    };
    reader.readAsText(file);
  }

  /* ==========================
     Utils & init
     ========================== */
  function escapeHtml(str){ return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

  // Events binding
  el('#openAuthBtn').addEventListener('click', openAuthModal);
  el('#openSellerBtn').addEventListener('click', openSellerPanel);
  el('#closeSellerBtn').addEventListener('click', closeSellerPanel);
  el('#newProductBtn').addEventListener('click', newProductFlow);
  el('#exportBtn').addEventListener('click', exportProducts);
  el('#importBtn').addEventListener('click', ()=> el('#importFile').click());
  el('#importFile').addEventListener('change', (e)=> {
    const f = e.target.files[0];
    if(f) importProductsFile(f);
    e.target.value='';
  });

  // cookie banner
  if(localStorage.getItem('cookiesAccepted') === 'true'){ document.getElementById('cookie-banner').style.display='none'; }
  el('#accept-cookies').addEventListener('click', function(){ localStorage.setItem('cookiesAccepted','true'); document.getElementById('cookie-banner').style.display='none'; });

  // search input Enter
  el('#searchInput').addEventListener('keydown', (e)=>{ if(e.key === 'Enter') applySearch(); });

  // cart button click (toggle) & initial render
  el('#cartButton').addEventListener('click', toggleCart);
  renderCart();

  // Seller panel show/hide state
  (function restoreSellerVisibility(){
    if(localStorage.getItem(SELLER_AUTH_KEY) === 'true') {
      // do nothing until user clicks Vendeur
    }
  })();

  // quick helper on page load
  document.addEventListener('DOMContentLoaded', ()=>{
    renderProducts(PRODUCTS);
    renderRecommendations();
    renderCart();
  });

  </script>
</body>
</html>



    
